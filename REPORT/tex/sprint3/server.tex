\section{Server}

\subsection{Communication Format}
The messages exchanged between the server and the clients are encoded as JSON and share a common format.
Every command has a \texttt{cmd} field indicating the type of command and a \texttt{data} field containing the data needed to process the command.
For some command types the \texttt{data} field may be \texttt{null} if no data is needed to process the command of that particular type.
All commands sent from a client to the server also contain an \texttt{id} field containing a unique identifier for the user.

All commands are prefixed with two bytes in network byte order (big endian) indicating the number of characters in the command.


\subsubsection{Matchmaking Commands}


\tikzstyle{decision} = [diamond, draw, fill=blue!20, text width=4.5em, text badly centered, node distance=3cm, inner sep=0pt]
\tikzstyle{block} = [rectangle, draw, fill=blue!20, text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse, fill=red!20, node distance=3cm, minimum height=2em]

\begin{center}
\begin{tikzpicture}[node distance=2.5cm, auto]
	% Place nodes
	\node [block] (notqueued) {not queued};
	\node [block, right of=notqueued, node distance=5cm] (queued) {queued};
	\node [block, below of=queued] (found) {match found};
	\node [block, below of=found] (accepted) {match accepted};
	\node [block, below of=accepted] (started) {match started};
	% Draw edges
	\path [line] (notqueued) -- node[] {queue [client]} (queued);
	\path [line] (queued) -- node[] {cancel [client]} (notqueued);
	\path [line] (queued) -- node[] {found [server]} (found);
	\path [line] (found) -- node[] {accept [client]} (accepted);
	\path [line] (found) -| node[] {decline [client]} (notqueued);
	\path [line] (accepted) -- node[] {start [server]} (started);
\end{tikzpicture}
\end{center}

\begin{table}[!ht]
	\centering
	\begin{tabular}{| r | p{3in} |}
		\hline
		\textbf{Description} & Places the client in the matchmaking queue. \\ \hline
		\textbf{Direction} & Client $\rightarrow$ Server. \\ \hline
		\textbf{Format} &
			\begin{verbatim}{
			"cmd": "cancel",
			"id": $id,
			"data": null
			}\end{verbatim} \\ \hline
	\end{tabular}
	\caption{}
	\label{}
\end{table}

\begin{verbatim}
{
	"cmd": "cancel",
	"id": $id,
	"data": null
}
\end{verbatim}

\hrule

\begin{description}
\item[Description] \hfill \\
	Removes the client from the matchmaking queue.
\item[Direction] \hfill \\
	Client $\rightarrow$ Server.
\item[Format] \hfill
\begin{lstlisting}[language=JavaScript]
{
	"cmd": "cancel",
	"id": $id,
	"data": null
}
\end{lstlisting}
\end{description}

\hrule

\begin{description}
\item[Description] \hfill \\
	Informs the client that an opponent has been found.
\item[Direction] \hfill \\
	Server $\rightarrow$ Client.
\item[Format] \hfill
\begin{lstlisting}[language=JavaScript]
{
	"cmd": "found",
	"id": $id,
	"data": null
}
\end{lstlisting}
\end{description}

\hrule

\begin{description}
\item[Description] \hfill \\
	Informs the server that the client accepts the match.
\item[Direction] \hfill \\
	Client $\rightarrow$ Server.
\item[Format] \hfill
\begin{lstlisting}[language=JavaScript]
{
	"cmd": "accept",
	"id": $id,
	"data": null
}
\end{lstlisting}
\end{description}

\hrule

\begin{description}
\item[Description] \hfill \\
	Informs the server that the client declines the match.
\item[Direction] \hfill \\
	Client $\rightarrow$ Server.
\item[Format] \hfill
\begin{lstlisting}[language=JavaScript]
{
	"cmd": "decline",
	"id": $id,
	"data": null
}
\end{lstlisting}
\end{description}

\hrule

\begin{description}
\item[Description] \hfill \\
	Informs the client that the match starts in 10 seconds.
\item[Direction] \hfill \\
	Server $\rightarrow$ Client.
\item[Format] \hfill
\begin{lstlisting}[language=JavaScript]
{
	"cmd": "start",
	"id": $id,
	"data": null
}
\end{lstlisting}
\end{description}
